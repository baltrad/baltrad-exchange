
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Command line tools &#8212; baltrad-exchange 0.1 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="REST interface" href="rest.html" />
    <link rel="prev" title="User Guide" href="userguide.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="rest.html" title="REST interface"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="userguide.html" title="User Guide"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">baltrad-exchange 0.1 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="command-line-tools">
<h1>Command line tools<a class="headerlink" href="#command-line-tools" title="Permalink to this headline">¶</a></h1>
<p>There are two different command line tools. One is used to help configuring the system in various ways from creating keys to testing out
if a specific filter is behaving as expected. The other tool is for communicating with the server.</p>
<div class="section" id="baltrad-exchange-config">
<h2>baltrad-exchange-config<a class="headerlink" href="#baltrad-exchange-config" title="Permalink to this headline">¶</a></h2>
<p>Like the command indicates, it’s used for various configuration purposes. Most essential is the one for creating keys since it’s essential
for a running system.</p>
<div class="section" id="create-keys">
<h3>create_keys<a class="headerlink" href="#create-keys" title="Permalink to this headline">¶</a></h3>
<p>This command will give you help creating the public/private keys used for the signature handling within the system. The default behaviour is to use “crypto” which
is the internally created handling using PyCryptodome as library and the service currently supports RSA and DSA keys. The nodename is essential since it will
be used to set information that will be used when identifying this node to other nodes. The command in itself is straight forward</p>
<p>You will get help on how to use the command by using the option ‘–help’</p>
<div class="code sh highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">%&gt;</span> <span class="n">baltrad</span><span class="o">-</span><span class="n">exchange</span><span class="o">-</span><span class="n">config</span> <span class="n">create_keys</span> <span class="o">--</span><span class="n">help</span>

 <span class="n">Options</span><span class="p">:</span>
<span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
<span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span>         <span class="n">be</span> <span class="n">verbose</span>
<span class="o">--</span><span class="nb">type</span><span class="o">=</span><span class="n">TYPE</span>           <span class="n">Library</span> <span class="n">to</span> <span class="n">use</span> <span class="k">for</span> <span class="n">generating</span> <span class="n">key</span><span class="o">-</span><span class="n">pair</span> <span class="n">to</span> <span class="n">create</span><span class="o">.</span>
                      <span class="n">Default</span><span class="p">:</span> <span class="n">crypto</span> <span class="p">(</span><span class="n">which</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">internal</span> <span class="n">key</span> <span class="n">handling</span><span class="p">)</span><span class="o">.</span>
                      <span class="n">Other</span> <span class="n">libraries</span> <span class="n">can</span> <span class="n">be</span> <span class="n">keyczar</span>
<span class="o">--</span><span class="n">encryption</span><span class="o">=</span><span class="n">ENCRYPTION</span>
                      <span class="n">Encryption</span> <span class="n">method</span> <span class="n">to</span> <span class="n">use</span><span class="o">.</span> <span class="n">For</span> <span class="n">internal</span> <span class="n">use</span> <span class="n">you</span> <span class="n">can</span>
                      <span class="n">either</span> <span class="n">choose</span> <span class="n">dsa</span> <span class="ow">or</span> <span class="n">rsa</span><span class="o">.</span> <span class="n">Default</span> <span class="ow">is</span><span class="p">:</span> <span class="n">dsa</span>
<span class="o">--</span><span class="n">destination</span><span class="o">=</span><span class="n">DESTINATION</span>
                      <span class="n">Directory</span> <span class="n">where</span> <span class="n">the</span> <span class="n">keys</span> <span class="n">should</span> <span class="n">be</span> <span class="n">placed</span><span class="o">.</span> <span class="n">Default</span> <span class="ow">is</span>
                      <span class="n">current</span> <span class="n">directory</span><span class="o">.</span>
<span class="o">--</span><span class="n">nodename</span><span class="o">=</span><span class="n">NODENAME</span>   <span class="n">Name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">node</span> <span class="k">for</span> <span class="n">this</span> <span class="n">server</span><span class="o">.</span>
</pre></div>
</div>
<div class="code sh highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%&gt;</span> <span class="n">baltrad</span><span class="o">-</span><span class="n">exchange</span><span class="o">-</span><span class="n">config</span> <span class="n">create_keys</span> <span class="o">--</span><span class="nb">type</span><span class="o">=</span><span class="n">crypto</span> <span class="o">--</span><span class="n">encryption</span><span class="o">=</span><span class="n">dsa</span> <span class="o">--</span><span class="n">destination</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">baltrad</span><span class="o">/</span><span class="n">exchange</span><span class="o">/</span><span class="n">crypto</span><span class="o">-</span><span class="n">keys</span> <span class="o">--</span><span class="n">nodename</span><span class="o">=</span><span class="n">myserver</span>
<span class="n">Created</span><span class="p">:</span>
  <span class="n">Private</span> <span class="n">key</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">baltrad</span><span class="o">/</span><span class="n">exchange</span><span class="o">/</span><span class="n">crypto</span><span class="o">-</span><span class="n">keys</span><span class="o">/</span><span class="n">myserver</span><span class="o">.</span><span class="n">private</span>
  <span class="n">Public</span>  <span class="n">key</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">baltrad</span><span class="o">/</span><span class="n">exchange</span><span class="o">/</span><span class="n">crypto</span><span class="o">-</span><span class="n">keys</span><span class="o">/</span><span class="n">myserver</span><span class="o">.</span><span class="n">public</span>
  <span class="n">Public</span> <span class="n">json</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">baltrad</span><span class="o">/</span><span class="n">exchange</span><span class="o">/</span><span class="n">crypto</span><span class="o">-</span><span class="n">keys</span><span class="o">/</span><span class="n">myserver_public</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>The other type that is of interest is the <strong>keyczar</strong> support since that provides backward compatibility with already existing installations. The keyczar-project has
been deprecated and is not supported any longer. However, to keep the exchange working, baltrad-exchange has got it’s own implementation that mimics the relevant
parts that has been used in the keyczar-library. This means that it is possible to read the public/private keys that has been generated during installation of the
baltrad software. It can also generate new keys compatible with the old installations. However, there is no support for setting up the DEX-subscription using this tool.</p>
<div class="code sh highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%&gt;</span> <span class="n">baltrad</span><span class="o">-</span><span class="n">exchange</span><span class="o">-</span><span class="n">config</span> <span class="n">create_keys</span> <span class="o">--</span><span class="nb">type</span><span class="o">=</span><span class="n">keyczar</span> <span class="o">--</span><span class="n">destination</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">baltrad</span><span class="o">/</span><span class="n">bltnode</span><span class="o">-</span><span class="n">keys</span> <span class="o">--</span><span class="n">nodename</span><span class="o">=</span><span class="n">myserver</span>
<span class="n">Created</span><span class="p">:</span>
  <span class="n">Private</span> <span class="n">key</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">baltrad</span><span class="o">/</span><span class="n">bltnode</span><span class="o">-</span><span class="n">keys</span><span class="o">/</span><span class="n">myserver</span><span class="o">.</span><span class="n">priv</span>
  <span class="n">Public</span>  <span class="n">key</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">baltrad</span><span class="o">/</span><span class="n">bltnode</span><span class="o">-</span><span class="n">keys</span><span class="o">/</span><span class="n">myserver</span><span class="o">.</span><span class="n">pub</span>
</pre></div>
</div>
</div>
<div class="section" id="test-filter">
<h3>test_filter<a class="headerlink" href="#test-filter" title="Permalink to this headline">¶</a></h3>
<p>Another useful tool is the test_filter which can be used to validate files against a filter to test how the subscription/publication filters should be defined. The matching uses the baltrad-db
metadata querying and will generate a odim-source sqlite database so that the _bdb/source_name, _bdb/source:WMO and other bdb-specific meta attributes can be ued. This is in contrast with the naming
that instead uses _baltrad/ as prefix for internal meta data usage.</p>
<p>A typical filter will have a structure will look something like.</p>
<div class="code json highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;filter&quot;</span><span class="p">:{</span>
  <span class="s2">&quot;filter_type&quot;</span><span class="p">:</span> <span class="s2">&quot;and_filter&quot;</span><span class="p">,</span>
  <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;filter_type&quot;</span><span class="p">:</span> <span class="s2">&quot;attribute_filter&quot;</span><span class="p">,</span>
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_bdb/source_name&quot;</span><span class="p">,</span>
      <span class="s2">&quot;operation&quot;</span><span class="p">:</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span>
      <span class="s2">&quot;value_type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sehem&quot;</span><span class="p">,</span><span class="s2">&quot;seang&quot;</span><span class="p">,</span> <span class="s2">&quot;sella&quot;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;filter_type&quot;</span><span class="p">:</span> <span class="s2">&quot;attribute_filter&quot;</span><span class="p">,</span>
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;/what/object&quot;</span><span class="p">,</span>
      <span class="s2">&quot;operation&quot;</span><span class="p">:</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span>
      <span class="s2">&quot;value_type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SCAN&quot;</span><span class="p">,</span><span class="s2">&quot;PVOL&quot;</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}}</span>
</pre></div>
</div>
<p>Since this section is about the test_filter command in the config-tool we will not explain more about the filter and refer to :ref: filters.rst.</p>
<p>The tool requires two mandatory options and the odim-h5 file to be matched against.</p>
<div class="code sh highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">anders</span><span class="nd">@host</span><span class="p">:</span> <span class="o">~</span> <span class="o">%&gt;</span> <span class="n">baltrad</span><span class="o">-</span><span class="n">exchange</span><span class="o">-</span><span class="n">config</span> <span class="n">test_filter</span> <span class="o">--</span><span class="n">help</span>
<span class="n">Usage</span><span class="p">:</span> <span class="n">baltrad</span><span class="o">-</span><span class="n">exchange</span><span class="o">-</span><span class="n">config</span> <span class="n">COMMAND</span> <span class="p">[</span><span class="n">ARGS</span><span class="p">]</span>

<span class="n">where</span> <span class="n">COMMAND</span> <span class="n">can</span> <span class="n">be</span> <span class="n">one</span> <span class="n">of</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">create_keys</span>
  <span class="o">-</span> <span class="n">test_filter</span>

<span class="n">to</span> <span class="n">get</span> <span class="n">more</span> <span class="n">information</span> <span class="n">about</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">command</span><span class="p">,</span> <span class="n">write</span> <span class="n">baltrad</span><span class="o">-</span><span class="n">exchange</span><span class="o">-</span><span class="n">config</span> <span class="o">&lt;</span><span class="n">COMMAND</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">help</span> <span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span>

<span class="n">Options</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span>         <span class="n">be</span> <span class="n">verbose</span>
  <span class="o">--</span><span class="n">odim</span><span class="o">-</span><span class="n">source</span><span class="o">=</span><span class="n">ODIM_SOURCE</span>
                        <span class="n">The</span> <span class="n">odim</span> <span class="n">source</span> <span class="n">file</span> <span class="n">to</span> <span class="n">use</span> <span class="k">for</span> <span class="n">identifying</span> <span class="n">the</span> <span class="n">source</span>
                        <span class="n">of</span> <span class="n">a</span> <span class="n">file</span><span class="o">.</span> <span class="n">This</span> <span class="n">command</span> <span class="n">will</span> <span class="n">create</span> <span class="n">a</span> <span class="n">temporary</span> <span class="n">source</span>
                        <span class="ow">in</span> <span class="o">/</span><span class="n">tmp</span> <span class="n">unless</span> <span class="n">underwise</span> <span class="n">specified</span><span class="o">.</span>
  <span class="o">--</span><span class="n">dburi</span><span class="o">=</span><span class="n">DBURI</span>         <span class="n">The</span> <span class="n">location</span> <span class="n">where</span> <span class="n">odim</span> <span class="n">sources</span> <span class="n">can</span> <span class="n">be</span> <span class="n">found</span><span class="o">.</span> <span class="n">Default</span>
                        <span class="ow">is</span> <span class="n">to</span> <span class="n">create</span> <span class="n">a</span> <span class="n">temporary</span> <span class="n">db</span> <span class="n">under</span> <span class="o">/</span><span class="n">tmp</span><span class="o">.</span>
  <span class="o">--</span><span class="nb">filter</span><span class="o">=</span><span class="n">FILTER</span>       <span class="n">Specifies</span> <span class="n">a</span> <span class="n">file</span> <span class="n">containing</span> <span class="n">a</span> <span class="nb">filter</span><span class="o">.</span> <span class="n">Can</span> <span class="n">be</span> <span class="n">either</span> <span class="n">a</span>
                        <span class="n">subscription</span> <span class="ow">or</span> <span class="n">publication</span> <span class="n">cfg</span><span class="o">-</span><span class="n">file</span> <span class="ow">or</span> <span class="k">else</span> <span class="n">a</span>
                        <span class="n">separate</span> <span class="n">file</span> <span class="n">containing</span> <span class="n">toplevel</span> <span class="s1">&#39;filter&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Command line tools</a><ul>
<li><a class="reference internal" href="#baltrad-exchange-config">baltrad-exchange-config</a><ul>
<li><a class="reference internal" href="#create-keys">create_keys</a></li>
<li><a class="reference internal" href="#test-filter">test_filter</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="userguide.html"
                        title="previous chapter">User Guide</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="rest.html"
                        title="next chapter">REST interface</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/commandline.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="rest.html" title="REST interface"
             >next</a> |</li>
        <li class="right" >
          <a href="userguide.html" title="User Guide"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">baltrad-exchange 0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Anders Henja.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>