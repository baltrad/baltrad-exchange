
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Command line tools &#8212; baltrad-exchange 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="REST interface" href="rest.html" />
    <link rel="prev" title="User Guide" href="userguide.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="rest.html" title="REST interface"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="userguide.html" title="User Guide"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">baltrad-exchange 0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Command line tools</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="command-line-tools">
<h1>Command line tools<a class="headerlink" href="#command-line-tools" title="Permalink to this headline">¶</a></h1>
<p>There are two different command line tools. One is used to help configuring the system in various ways from creating keys to testing out
if a specific filter is behaving as expected. The other tool is for communicating with the server.</p>
<section id="baltrad-exchange-config">
<h2>baltrad-exchange-config<a class="headerlink" href="#baltrad-exchange-config" title="Permalink to this headline">¶</a></h2>
<p>Like the command indicates, it’s used for various configuration purposes. Most essential is the one for creating keys since it’s essential
for a running system.</p>
<section id="create-keys">
<h3>create_keys<a class="headerlink" href="#create-keys" title="Permalink to this headline">¶</a></h3>
<p>This command will give you help creating the public/private keys used for the signature handling within the system. The default behaviour is to use “crypto” which
is the internally created handling using PyCryptodome as library and the service currently supports RSA and DSA keys. The nodename is essential since it will
be used to set information that will be used when identifying this node to other nodes. The command in itself is straight forward</p>
<p>You will get help on how to use the command by using the option ‘–help’</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span> %&gt; baltrad-exchange-config create_keys --help

 Options:
-h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
-v, --verbose         be verbose
--type<span class="o">=</span>TYPE           Library to use <span class="k">for</span> generating key-pair to create.
                      Default: crypto <span class="o">(</span>which is the internal key handling<span class="o">)</span>.
                      Other libraries can be keyczar
--encryption<span class="o">=</span>ENCRYPTION
                      Encryption method to use. For internal use you can
                      either choose dsa or rsa. Default is: dsa
--destination<span class="o">=</span>DESTINATION
                      Directory where the keys should be placed. Default is
                      current directory.
--nodename<span class="o">=</span>NODENAME   Name of the node <span class="k">for</span> this server.
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>%&gt; baltrad-exchange-config create_keys --type<span class="o">=</span>crypto --encryption<span class="o">=</span>dsa --destination<span class="o">=</span>/etc/baltrad/exchange/crypto-keys --nodename<span class="o">=</span>myserver
Created:
  Private key: /etc/baltrad/exchange/crypto-keys/myserver.private
  Public  key: /etc/baltrad/exchange/crypto-keys/myserver.public
  Public json: /etc/baltrad/exchange/crypto-keys/myserver_public.json
</pre></div>
</div>
<p>The other type that is of interest is the <strong>keyczar</strong> support since that provides backward compatibility with already existing installations. The keyczar-project has
been deprecated and is not supported any longer. However, to keep the exchange working, baltrad-exchange has got it’s own implementation that mimics the relevant
parts that has been used in the keyczar-library. This means that it is possible to read the public/private keys that has been generated during installation of the
baltrad software. It can also generate new keys compatible with the old installations. However, there is no support for setting up the DEX-subscription using this tool.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>%&gt; baltrad-exchange-config create_keys --type<span class="o">=</span>keyczar --destination<span class="o">=</span>/etc/baltrad/bltnode-keys --nodename<span class="o">=</span>myserver
Created:
  Private key: /etc/baltrad/bltnode-keys/myserver.priv
  Public  key: /etc/baltrad/bltnode-keys/myserver.pub
</pre></div>
</div>
</section>
<section id="test-filter">
<h3>test_filter<a class="headerlink" href="#test-filter" title="Permalink to this headline">¶</a></h3>
<p>Another useful tool is the test_filter which can be used to validate files against a filter to test how the subscription/publication filters should be defined. The matching uses the baltrad-db
metadata querying and will generate a odim-source sqlite database so that the _bdb/source_name, _bdb/source:WMO and other bdb-specific meta attributes can be ued. This is in contrast with the naming
that instead uses _baltrad/ as prefix for internal meta data usage.</p>
<p>A typical filter will have a structure will look something like.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;filter&quot;</span><span class="p">:{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;filter_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;and_filter&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;filter_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;attribute_filter&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;_bdb/source_name&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;in&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;value_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;sehem&quot;</span><span class="p">,</span><span class="s2">&quot;seang&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;sella&quot;</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;filter_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;attribute_filter&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/what/object&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;in&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;value_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;SCAN&quot;</span><span class="p">,</span><span class="s2">&quot;PVOL&quot;</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="p">}}</span><span class="w"></span>
</pre></div>
</div>
<p>Since this section is about the test_filter command in the config-tool we will not explain more about the filter and refer to :ref: filters.rst.</p>
<p>The tool requires two mandatory options and the odim-h5 file to be matched against.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>anders@host: ~ %&gt; baltrad-exchange-config test_filter --help
Usage: baltrad-exchange-config COMMAND <span class="o">[</span>ARGS<span class="o">]</span>

where COMMAND can be one of:
  - create_keys
  - test_filter

to get more information about a specific command, write baltrad-exchange-config &lt;COMMAND&gt; --help &lt;filename&gt;

Options:
  -h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
  -v, --verbose         be verbose
  --odim-source<span class="o">=</span>ODIM_SOURCE
                        The odim <span class="nb">source</span> file to use <span class="k">for</span> identifying the <span class="nb">source</span>
                        of a file. This <span class="nb">command</span> will create a temporary <span class="nb">source</span>
                        <span class="k">in</span> /tmp unless underwise specified.
  --dburi<span class="o">=</span>DBURI         The location where odim sources can be found. Default
                        is to create a temporary db under /tmp.
  --filter<span class="o">=</span>FILTER       Specifies a file containing a filter. Can be either a
                        subscription or publication cfg-file or <span class="k">else</span> a
                        separate file containing toplevel <span class="s1">&#39;filter&#39;</span>
</pre></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Command line tools</a><ul>
<li><a class="reference internal" href="#baltrad-exchange-config">baltrad-exchange-config</a><ul>
<li><a class="reference internal" href="#create-keys">create_keys</a></li>
<li><a class="reference internal" href="#test-filter">test_filter</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="userguide.html"
                        title="previous chapter">User Guide</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="rest.html"
                        title="next chapter">REST interface</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/commandline.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="rest.html" title="REST interface"
             >next</a> |</li>
        <li class="right" >
          <a href="userguide.html" title="User Guide"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">baltrad-exchange 0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Command line tools</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Anders Henja.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.2.
    </div>
  </body>
</html>