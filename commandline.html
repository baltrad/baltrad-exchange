
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Command line tools &#8212; baltrad-exchange 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="REST interface" href="rest.html" />
    <link rel="prev" title="User Guide" href="userguide.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="rest.html" title="REST interface"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="userguide.html" title="User Guide"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">baltrad-exchange 0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Command line tools</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="command-line-tools">
<h1>Command line tools<a class="headerlink" href="#command-line-tools" title="Permalink to this headline">¶</a></h1>
<p>There are two different command line tools. One is used to help configuring the system in various ways from creating keys to testing out
if a specific filter is behaving as expected. The other tool is for communicating with the server.</p>
<section id="baltrad-exchange-config">
<h2>baltrad-exchange-config<a class="headerlink" href="#baltrad-exchange-config" title="Permalink to this headline">¶</a></h2>
<p>Like the command indicates, it’s used for various configuration purposes. Most essential is the one for creating keys since it’s essential
for a running system.</p>
<section id="create-keys">
<h3>create_keys<a class="headerlink" href="#create-keys" title="Permalink to this headline">¶</a></h3>
<p>This command will give you help creating the public/private keys used for the signature handling within the system. The default behaviour is to use “crypto” which
is the internally created handling using PyCryptodome as library and the service currently supports RSA and DSA keys. The nodename is essential since it will
be used to set information that will be used when identifying this node to other nodes. The command in itself is straight forward</p>
<p>You will get help on how to use the command by using the option ‘–help’</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span> %&gt; baltrad-exchange-config create_keys --help

 Options:
-h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
-v, --verbose         be verbose
--type<span class="o">=</span>TYPE           Library to use <span class="k">for</span> generating key-pair to create.
                      Default: crypto <span class="o">(</span>which is the internal key handling<span class="o">)</span>.
                      Other libraries can be keyczar
--encryption<span class="o">=</span>ENCRYPTION
                      Encryption method to use. For internal use you can
                      either choose dsa or rsa. Default is: dsa
--destination<span class="o">=</span>DESTINATION
                      Directory where the keys should be placed. Default is
                      current directory.
--nodename<span class="o">=</span>NODENAME   Name of the node <span class="k">for</span> this server.
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>%&gt; baltrad-exchange-config create_keys --type<span class="o">=</span>crypto --encryption<span class="o">=</span>dsa --destination<span class="o">=</span>/etc/baltrad/exchange/crypto-keys --nodename<span class="o">=</span>myserver
Created:
  Private key: /etc/baltrad/exchange/crypto-keys/myserver.private
  Public  key: /etc/baltrad/exchange/crypto-keys/myserver.public
  Public json: /etc/baltrad/exchange/crypto-keys/myserver_public.json
</pre></div>
</div>
<p>The other type that is of interest is the <strong>keyczar</strong> support since that provides backward compatibility with already existing installations. The keyczar-project has
been deprecated and is not supported any longer. However, to keep the exchange working, baltrad-exchange has got it’s own implementation that mimics the relevant
parts that has been used in the keyczar-library. This means that it is possible to read the public/private keys that has been generated during installation of the
baltrad software. It can also generate new keys compatible with the old installations. However, there is no support for setting up the DEX-subscription using this tool.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>%&gt; baltrad-exchange-config create_keys --type<span class="o">=</span>keyczar --destination<span class="o">=</span>/etc/baltrad/bltnode-keys --nodename<span class="o">=</span>myserver
Created:
  Private key: /etc/baltrad/bltnode-keys/myserver.priv
  Public  key: /etc/baltrad/bltnode-keys/myserver.pub
</pre></div>
</div>
</section>
<section id="create-publication">
<h3>create_publication<a class="headerlink" href="#create-publication" title="Permalink to this headline">¶</a></h3>
<p>Creates a publication from the provided template and the provided property-file. If possible, the
property file will be identified by checking standard installation path. An atempt to find the
template will be used base on default location / name as well. The resulting json file should be
possible to put in the local server config catalogue without modifications. If different sender
protocols or different connection strategies should be used the configuration file needs to be modified
manually.</p>
<p>Example: baltrad-exchange-config create_publication –desturi=https://remote.baltrad.node –name=”pub to remote node” –output=remote_node_publication.json</p>
<dl>
<dt>Options:</dt><dd><dl class="option-list">
<dt><kbd><span class="option">-h</span>, <span class="option">--help</span></kbd></dt>
<dd><p>show this help message and exit</p>
</dd>
<dt><kbd><span class="option">-v</span>, <span class="option">--verbose</span></kbd></dt>
<dd><p>be verbose</p>
</dd>
<dt><kbd><span class="option">--conf=<var>CONF</var></span></kbd></dt>
<dd><p>Specified the property file to use to extract all
relevant information to create the publication to
specified host.</p>
</dd>
<dt><kbd><span class="option">--template=<var>TEMPLATE</var></span></kbd></dt>
<dd><p>The template to use for generating the publication /
subscription.</p>
</dd>
<dt><kbd><span class="option">--desturi=<var>DESTURI</var></span></kbd></dt>
<dd><p>Specified the target of this publication</p>
</dd>
<dt><kbd><span class="option">--name=<var>PUBLICATION_NAME</var></span></kbd></dt>
<dd><p>The name of this publication. MANDATORY!</p>
</dd>
<dt><kbd><span class="option">--output=<var>OUTPUT</var></span></kbd></dt>
<dd><p>The output file name. If not specified, output will
printed on stdout</p>
</dd>
</dl>
</dd>
</dl>
</section>
<section id="create-subscription">
<h3>create_subscription<a class="headerlink" href="#create-subscription" title="Permalink to this headline">¶</a></h3>
<p>Usage: baltrad-exchange-config create_subscription [OPTIONS]</p>
<p>Creates a subscription package from the provided template and the provided property-file. If possible, the
property file will be identified by checking standard installation path. An atempt to find the
template will be used base on default location / name as well. The output will be a tarball containing of one
public key and one subscription.json file and mailed to the admin for the remote server.</p>
<p>Example: baltrad-exchange-config create_subscription –output=subscription_bundle.tar</p>
<dl>
<dt>Options:</dt><dd><dl class="option-list">
<dt><kbd><span class="option">-h</span>, <span class="option">--help</span></kbd></dt>
<dd><p>show this help message and exit</p>
</dd>
<dt><kbd><span class="option">-v</span>, <span class="option">--verbose</span></kbd></dt>
<dd><p>be verbose</p>
</dd>
<dt><kbd><span class="option">--conf=<var>CONF</var></span></kbd></dt>
<dd><p>Specified the property file to use to extract all
relevant information to create the publication to
specified host.</p>
</dd>
<dt><kbd><span class="option">--template=<var>TEMPLATE</var></span></kbd></dt>
<dd><p>The template to use for generating the publication /
subscription.</p>
</dd>
<dt><kbd><span class="option">--output=<var>OUTPUT</var></span></kbd></dt>
<dd><p>The output file name. Must contain .tar och .tgz or
.tar.gz suffix. Will default to &lt;nodename&gt;.tar.gz</p>
</dd>
</dl>
</dd>
</dl>
</section>
<section id="test-filter">
<h3>test_filter<a class="headerlink" href="#test-filter" title="Permalink to this headline">¶</a></h3>
<p>Another useful tool is the test_filter which can be used to validate files against a filter to test how the subscription/publication filters should be defined. The matching uses the baltrad-db
metadata querying and will generate a odim-source sqlite database so that the _bdb/source_name, _bdb/source:WMO and other bdb-specific meta attributes can be ued. This is in contrast with the naming
that instead uses _baltrad/ as prefix for internal meta data usage.</p>
<p>A typical filter will have a structure will look something like.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;filter&quot;</span><span class="p">:{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;filter_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;and_filter&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;filter_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;attribute_filter&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;_bdb/source_name&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;in&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;value_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;sehem&quot;</span><span class="p">,</span><span class="s2">&quot;seang&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;sella&quot;</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;filter_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;attribute_filter&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/what/object&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;in&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;value_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;SCAN&quot;</span><span class="p">,</span><span class="s2">&quot;PVOL&quot;</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="p">}}</span><span class="w"></span>
</pre></div>
</div>
<p>Since this section is about the test_filter command in the config-tool we will not explain more about the filter and refer to :ref: filters.rst.</p>
<p>The tool requires two mandatory options and the odim-h5 file to be matched against.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>anders@host: ~ %&gt; baltrad-exchange-config test_filter --help
Usage: baltrad-exchange-config COMMAND <span class="o">[</span>ARGS<span class="o">]</span>

where COMMAND can be one of:
  - create_keys
  - test_filter

to get more information about a specific command, write baltrad-exchange-config &lt;COMMAND&gt; --help &lt;filename&gt;

Options:
  -h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
  -v, --verbose         be verbose
  --odim-source<span class="o">=</span>ODIM_SOURCE
                        The odim <span class="nb">source</span> file to use <span class="k">for</span> identifying the <span class="nb">source</span>
                        of a file. This <span class="nb">command</span> will create a temporary <span class="nb">source</span>
                        <span class="k">in</span> /tmp unless underwise specified.
  --dburi<span class="o">=</span>DBURI         The location where odim sources can be found. Default
                        is to create a temporary db under /tmp.
  --filter<span class="o">=</span>FILTER       Specifies a file containing a filter. Can be either a
                        subscription or publication cfg-file or <span class="k">else</span> a
                        separate file containing toplevel <span class="s1">&#39;filter&#39;</span>
</pre></div>
</div>
</section>
</section>
<section id="baltrad-exchange-client">
<h2>baltrad-exchange-client<a class="headerlink" href="#baltrad-exchange-client" title="Permalink to this headline">¶</a></h2>
<p>This tool is used to communicate with the server in various ways. Examples of use can be to store files or to query for statistics and other server information.
It is possible to get available commands by running</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>%&gt; baltrad-exchange-client --help
Usage: baltrad-exchange-client COMMAND <span class="o">[</span>ARGS<span class="o">]</span>

where COMMAND can be one of:
  - batchtest
  - file_arrival
  - get_statistics
  - list_statistic_ids
  - post_message
  - server_info
  - store

to get more information about a specific command, write baltrad-exchange-client &lt;COMMAND&gt; --help
</pre></div>
</div>
<p>When communicating with the server it is in most cases required to provide security-related options and these options are common for all commands.</p>
<ul class="simple">
<li><p><strong>–conf=CONF</strong> Specifies the configuration file to use for extracting required option values.
Default is to use the installations config file which usually is located under /etc/baltrad/exchange/etc/baltrad-exchange.properties</p></li>
<li><p><strong>–noconf</strong> Disables the usage of property file and expects all attributes to be provided on command line. Can be useful in some circumstances</p></li>
<li><p><strong>–url=SERVER_URL</strong> The location of the server. Usually <a class="reference external" href="http://localhost:8089">http://localhost:8089</a> or <a class="reference external" href="https://localhost:8089">https://localhost:8089</a>.</p></li>
<li><p><strong>-t TYPE, –type=TYPE</strong> Type of encryption to use. Either crypto, keyczar or noauth</p></li>
<li><p><strong>-k KEY –key=KEY</strong> The path to the private key to sign messages with.</p></li>
<li><p><strong>-n NAME –name=NAME</strong> The name to use as node-name.</p></li>
</ul>
<p>When the baltrad-config-client binary is executed,  url, type, key and name will be determined by reading the options from the property-file and these
will be used as default values. Then, if the options are provided these will override the default values. This obviously will require that the user
running the baltrad-exchange-client command is allowed to read the private key.</p>
<p>All other options are specific to the above commands. The help section for each of the commands will explain more about how to use each command.</p>
<section id="batchtest">
<span id="doc-rest-cmd-batchtest"></span><h3>batchtest<a class="headerlink" href="#batchtest" title="Permalink to this headline">¶</a></h3>
<p>The batchtest uses a basefile that either is a scan or a pvol and uses that as a template and then updates the source and datetime before sending it to the exchange server. It is only the
information for the swedish radars sekrn, sella, seosd, seoer, sehuv, selek, sehem, seatv, sevax, seang, sekaa and sebaa that will be set in what/source. The soure set will be in the format
WMO:02666,RAD:SE51,PLC:Karlskrona,CMT:sekaa,NOD:sekaa.</p>
<p>Example:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>%&gt; baltrad-exchange-client batchtest --basefile<span class="o">=</span>/data/incomming/seang_scan_202212150100_0_5.h5
</pre></div>
</div>
</section>
<section id="file-arrival">
<span id="doc-rest-cmd-file-arrival"></span><h3>file_arrival<a class="headerlink" href="#file-arrival" title="Permalink to this headline">¶</a></h3>
<p>Usage: baltrad-exchange-client file_arrival [OPTIONS]</p>
<p>Functionality for querying if a file from a specific source has arrived within a given time.</p>
<p>The returned data will be a json dictionary with status as name and either ERROR or OK in the value.</p>
<p>Example: baltrad-exchange-client file_arrival –source=sella –object_type=PVOL –limit=5
{“status: “OK”}</p>
<p><strong>Note</strong> The property <strong>baltrad.exchange.server.statistics.incomming</strong> has to be True in order for this command to work.</p>
</section>
<section id="get-statistics">
<span id="doc-rest-cmd-get-statistics"></span><h3>get_statistics<a class="headerlink" href="#get-statistics" title="Permalink to this headline">¶</a></h3>
<p>Usage: baltrad-exchange-client get_statistics [OPTIONS] –spid=STAT_ID</p>
<p>Queries the exchange server for various statistics information. The spid is used to identify what statistics
id that should be queried for. It is possible to query for all existing ids by executing the command
list_statistic_ids.</p>
<p>Example:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>%&gt; baltrad-exchange-client get_statistics --spid<span class="o">=</span>server-incomming --totals
</pre></div>
</div>
</section>
<section id="list-statistic-ids">
<span id="doc-rest-cmd-list-statistic-ids"></span><h3>list_statistic_ids<a class="headerlink" href="#list-statistic-ids" title="Permalink to this headline">¶</a></h3>
<p>Usage: baltrad-exchange-client list_statistic_ids [OPTIONS]</p>
<p>Queries the exchange server for the available statistics ids</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>%&gt; baltrad-exchange-client list_statistic_ids
</pre></div>
</div>
</section>
<section id="post-message">
<span id="doc-rest-cmd-post-json-message"></span><h3>post_message<a class="headerlink" href="#post-message" title="Permalink to this headline">¶</a></h3>
<p>Usage: baltrad-exchange-client post_message [OPTIONS] MESSAGE</p>
<p>Posts a json message to the exchange server. Can be used to trigger for example a runnable job.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>%&gt; baltrad-exchange-client post_message <span class="s1">&#39;{&quot;trigger&quot;:&quot;trigger_4&quot;}&#39;</span>
</pre></div>
</div>
<p id="doc-rest-cmd-server-info">server_info</p>
<p>Usage: baltrad-exchange-client server_info [OPTIONS]</p>
<p>Provides some useful information about the server. Currently the following things can be queried for.</p>
<blockquote>
<div><ul class="simple">
<li><p>uptime
How long the server has been running</p></li>
<li><p>nodename
The name this server is identifying itself when sending files</p></li>
<li><p>publickey
The public key that can be used to identify myself as</p></li>
</ul>
</div></blockquote>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>%&gt; baltrad-exchange-client server_info uptime
</pre></div>
</div>
</section>
<section id="store">
<span id="doc-rest-cmd-store-file"></span><h3>store<a class="headerlink" href="#store" title="Permalink to this headline">¶</a></h3>
<p>Usage: baltrad-exchange-client store [OPTIONS] FILE [ FILE]</p>
<p>Posts a sequence of files to the exchange server.</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Command line tools</a><ul>
<li><a class="reference internal" href="#baltrad-exchange-config">baltrad-exchange-config</a><ul>
<li><a class="reference internal" href="#create-keys">create_keys</a></li>
<li><a class="reference internal" href="#create-publication">create_publication</a></li>
<li><a class="reference internal" href="#create-subscription">create_subscription</a></li>
<li><a class="reference internal" href="#test-filter">test_filter</a></li>
</ul>
</li>
<li><a class="reference internal" href="#baltrad-exchange-client">baltrad-exchange-client</a><ul>
<li><a class="reference internal" href="#batchtest">batchtest</a></li>
<li><a class="reference internal" href="#file-arrival">file_arrival</a></li>
<li><a class="reference internal" href="#get-statistics">get_statistics</a></li>
<li><a class="reference internal" href="#list-statistic-ids">list_statistic_ids</a></li>
<li><a class="reference internal" href="#post-message">post_message</a></li>
<li><a class="reference internal" href="#store">store</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="userguide.html"
                        title="previous chapter">User Guide</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="rest.html"
                        title="next chapter">REST interface</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/commandline.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="rest.html" title="REST interface"
             >next</a> |</li>
        <li class="right" >
          <a href="userguide.html" title="User Guide"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">baltrad-exchange 0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Command line tools</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Anders Henja.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.2.
    </div>
  </body>
</html>